import{a as Z,i as M,b as k}from"./axios-ugFzd9eS.js";import{m as O,d as ee,s as te,g as x,i as B,o as H}from"./lodash-es-BeZXkzNc.js";let m=Z.create(),z=(e,r)=>`${e.method}:${e.baseURL??r.defaults.baseURL??""}${e.url}`,G=e=>e.status===204&&e.headers["precognition-success"]==="true";const V={},h={get:(e,r={},s={})=>b(E("get",e,r,s)),post:(e,r={},s={})=>b(E("post",e,r,s)),patch:(e,r={},s={})=>b(E("patch",e,r,s)),put:(e,r={},s={})=>b(E("put",e,r,s)),delete:(e,r={},s={})=>b(E("delete",e,r,s)),use(e){return m=e,h},axios(){return m},fingerprintRequestsUsing(e){return z=e===null?()=>null:e,h},determineSuccessUsing(e){return G=e,h}},E=(e,r,s,i)=>({url:r,method:e,...i,...["get","delete"].includes(e)?{params:O({},s,i==null?void 0:i.params)}:{data:O({},s,i==null?void 0:i.data)}}),b=(e={})=>{const r=[re,se,oe].reduce((s,i)=>i(s),e);return(r.onBefore??(()=>!0))()===!1?Promise.resolve(null):((r.onStart??(()=>null))(),m.request(r).then(async s=>{r.precognitive&&N(s);const i=s.status;let a=s;return r.precognitive&&r.onPrecognitionSuccess&&G(a)&&(a=await Promise.resolve(r.onPrecognitionSuccess(a)??a)),r.onSuccess&&ne(i)&&(a=await Promise.resolve(r.onSuccess(a)??a)),($(r,i)??(c=>c))(a)??a},s=>ie(s)?Promise.reject(s):(r.precognitive&&N(s.response),($(r,s.response.status)??((a,f)=>Promise.reject(f)))(s.response,s))).finally(r.onFinish??(()=>null)))},re=e=>({...e,timeout:e.timeout??m.defaults.timeout??3e4,precognitive:e.precognitive!==!1,fingerprint:typeof e.fingerprint>"u"?z(e,m):e.fingerprint,headers:{...e.headers,"Content-Type":ae(e),...e.precognitive!==!1?{Precognition:!0}:{},...e.validate?{"Precognition-Validate-Only":Array.from(e.validate).join()}:{}}}),ne=e=>e>=200&&e<300,se=e=>{var r;return typeof e.fingerprint!="string"||((r=V[e.fingerprint])==null||r.abort(),delete V[e.fingerprint]),e},oe=e=>typeof e.fingerprint!="string"||e.signal||e.cancelToken?e:(V[e.fingerprint]=new AbortController,{...e,signal:V[e.fingerprint].signal}),N=e=>{var r;if(((r=e.headers)==null?void 0:r.precognition)!=="true")throw Error("Did not receive a Precognition response. Ensure you have the Precognition middleware in place for the route.")},ie=e=>{var r;return!M(e)||typeof((r=e.response)==null?void 0:r.status)!="number"||k(e)},$=(e,r)=>({401:e.onUnauthorized,403:e.onForbidden,404:e.onNotFound,409:e.onConflict,422:e.onValidationError,423:e.onLocked})[r],ae=e=>{var r,s,i;return((r=e.headers)==null?void 0:r["Content-Type"])??((s=e.headers)==null?void 0:s["Content-type"])??((i=e.headers)==null?void 0:i["content-type"])??(_(e.data)?"multipart/form-data":"application/json")},_=e=>j(e)||typeof e=="object"&&e!==null&&Object.values(e).some(r=>_(r)),j=e=>typeof File<"u"&&e instanceof File||e instanceof Blob||typeof FileList<"u"&&e instanceof FileList&&e.length>0,de=e=>typeof e=="string"?e:e(),pe=e=>typeof e=="string"?e.toLowerCase():e(),he=(e,r={})=>{const s={errorsChanged:[],touchedChanged:[],validatingChanged:[],validatedChanged:[]};let i=!1,a=!1;const f=t=>t!==a?(a=t,s.validatingChanged):[];let c=[];const w=t=>{const n=[...new Set(t)];return c.length!==n.length||!n.every(o=>c.includes(o))?(c=n,s.validatedChanged):[]},J=()=>c.filter(t=>typeof p[t]>"u");let u=[];const C=t=>{const n=[...new Set(t)];return u.length!==n.length||!n.every(o=>u.includes(o))?(u=n,s.touchedChanged):[]};let p={};const P=t=>{const n=le(t);return B(p,n)?[]:(p=n,s.errorsChanged)},K=t=>{const n={...p};return delete n[q(t)],P(n)},Q=()=>Object.keys(p).length>0;let D=1500;const W=t=>{D=t,F.cancel(),F=U()};let S=r,A=null,L=[],R=null;const U=()=>ee(()=>{e({get:(t,n={},o={})=>h.get(t,g(n),v(o,n)),post:(t,n={},o={})=>h.post(t,g(n),v(o,n)),patch:(t,n={},o={})=>h.patch(t,g(n),v(o,n)),put:(t,n={},o={})=>h.put(t,g(n),v(o,n)),delete:(t,n={},o={})=>h.delete(t,g(n),v(o,n))}).catch(t=>M(t)?null:Promise.reject(t))},D,{leading:!0,trailing:!0});let F=U();const v=(t,n={})=>{const o=Array.from(t.validate??u);return{...t,validate:o,timeout:t.timeout??5e3,onValidationError:(l,y)=>([...w([...c,...o]),...P(O(H({...p},o),l.data.errors))].forEach(T=>T()),t.onValidationError?t.onValidationError(l,y):Promise.reject(y)),onSuccess:()=>{w([...c,...o]).forEach(l=>l())},onPrecognitionSuccess:l=>([...w([...c,...o]),...P(H({...p},o))].forEach(y=>y()),t.onPrecognitionSuccess?t.onPrecognitionSuccess(l):l),onBefore:()=>(t.onBeforeValidation??((T,Y)=>!B(T,Y)))({data:n,touched:u},{data:S,touched:L})===!1||(t.onBefore||(()=>!0))()===!1?!1:(R=u,A=n,!0),onStart:()=>{f(!0).forEach(l=>l()),(t.onStart??(()=>null))()},onFinish:()=>{f(!1).forEach(l=>l()),L=R,S=A,R=A=null,(t.onFinish??(()=>null))()}}},X=(t,n)=>{if(typeof t>"u"){F();return}if(j(n)&&!i){console.warn('Precognition file validation is not active. Call the "validateFiles" function on your form to enable it.');return}t=q(t),x(S,t)!==n&&C([t,...u]).forEach(o=>o()),u.length!==0&&F()},g=t=>i===!1?I(t):t,d={touched:()=>u,validate(t,n){return X(t,n),d},touch(t){const n=Array.isArray(t)?t:[q(t)];return C([...u,...n]).forEach(o=>o()),d},validating:()=>a,valid:J,errors:()=>p,hasErrors:Q,setErrors(t){return P(t).forEach(n=>n()),d},forgetError(t){return K(t).forEach(n=>n()),d},reset(...t){if(t.length===0)C([]).forEach(n=>n());else{const n=[...u];t.forEach(o=>{n.includes(o)&&n.splice(n.indexOf(o),1),te(S,o,x(r,o))}),C(n).forEach(o=>o())}return d},setTimeout(t){return W(t),d},on(t,n){return s[t].push(n),d},validateFiles(){return i=!0,d}};return d},fe=e=>Object.keys(e).reduce((r,s)=>({...r,[s]:Array.isArray(e[s])?e[s][0]:e[s]}),{}),le=e=>Object.keys(e).reduce((r,s)=>({...r,[s]:typeof e[s]=="string"?[e[s]]:e[s]}),{}),q=e=>typeof e!="string"?e.target.name:e,I=e=>{const r={...e};return Object.keys(r).forEach(s=>{const i=r[s];if(i!==null){if(j(i)){delete r[s];return}if(Array.isArray(i)){r[s]=i.filter(a=>!j(a));return}if(typeof i=="object"){r[s]=I(r[s]);return}}}),r};export{pe as a,q as b,he as c,h as d,de as r,fe as t};
